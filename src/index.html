<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>IglViewer</title>
  <base href="./">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <style>
      body {
          background-color: #000;
          margin: 0px;
          overflow: hidden;
      }
  </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/88/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.88.0/examples/js/Detector.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.88.0/examples/js/controls/OrbitControls.min.js"></script>

    <!-- to update the addon called in igl.js, execute 'npm run electron-rebuild' -->
    <script src = "igl.js"></script>

    <script>
      // test if WebGL is available
      if (!Detector.webgl) {
        Detector.addGetWebGLMessage();
      }

      var group, camera, scene, renderer;

      init();
      animate();

      function init() {
          scene = new THREE.Scene();

          renderer = new THREE.WebGLRenderer({antialias: true});
          renderer.setPixelRatio(window.devicePixelRatio);
          renderer.setSize(window.innerWidth, window.innerHeight);
          document.body.appendChild(renderer.domElement);

          // camera
          camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 1, 1000);
          camera.position.set(30, 40, 60);
          scene.add(camera);

          // controls
          var controls = new THREE.OrbitControls(camera, renderer.domElement);

          // lights
          scene.add(new THREE.AmbientLight(0x222222));
          scene.add(new THREE.PointLight(0xffffff, 1));

          scene.add(new THREE.AxesHelper(20));

          group = new THREE.Group();
          scene.add(group);

          var meshMaterial = new THREE.MeshLambertMaterial({
              color: 0xff00dd,
              opacity: 1.0,
              transparent: false,
              polygonOffset: true,
              polygonOffsetFactor: 1, // positive value pushes polygon further away
              polygonOffsetUnits: 1
          });

          var geometry = new THREE.Geometry();

          var Vrows = iglMesh[0][0];
          var Frows = iglMesh[0][1];

          for (var i = 1; i < Vrows + 1; ++i) {
              var x = iglMesh[i][0] * 100;
              var y = iglMesh[i][1] * 100;
              var z = iglMesh[i][2] * 100;

              geometry.vertices.push(new THREE.Vector3(x, y, z));
          }

          for (var i = Vrows + 1; i < Frows + Vrows + 1; ++i) {
              var x = iglMesh[i][0];
              var y = iglMesh[i][1];
              var z = iglMesh[i][2];

              geometry.faces.push(new THREE.Face3(x, y, z));
          }

          geometry.computeFaceNormals();
          geometry.computeVertexNormals();

          var mesh = new THREE.Mesh(geometry, meshMaterial);
          mesh.material.side = THREE.FrontSide;
          mesh.renderOrder = 0;
          group.add(mesh);

          // wireframe
          var geo = new THREE.EdgesGeometry( mesh.geometry ); // or WireframeGeometry
          var mat = new THREE.LineBasicMaterial( { color: 0xffffff, linewidth: 1 } );
          var wireframe = new THREE.LineSegments( geo, mat );
          mesh.add(wireframe);

          window.addEventListener('resize', onWindowResize, false);
      }

      function animate() {
          requestAnimationFrame(animate);

          //group.rotation.y += 0.005;

          render();
      }

      function render() {
          renderer.render(scene, camera);
      }

      function onWindowResize() {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();

          renderer.setSize(window.innerWidth, window.innerHeight);
      }
    </script>
</body>
</html>
